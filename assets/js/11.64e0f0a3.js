(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{180:function(e,t,s){"use strict";s.r(t);var n=s(0),a=Object(n.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[e._m(0),e._v(" "),e._m(1),e._v(" "),s("p",[e._v("Docker runs the individual components of our application in containers. For example, the API server, the MongoDB, etc.")]),e._v(" "),s("p",[e._v("Docker-compose orchestrates the set of containers that provide the whole application.")]),e._v(" "),s("p",[e._v("You need to have docker and docker-compose installed to run this project.  To get started you can see the helpful references at the bottom of this page")]),e._v(" "),e._m(2),e._v(" "),s("p",[e._v("On the Mac when you first start the app you may see an error like this:")]),e._v(" "),e._m(3),s("p",[e._v("The error message will tell you to look "),s("a",{attrs:{href:"https://docs.docker.com/docker-for-mac/osxfs/#namespaces",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),s("OutboundLink")],1),e._v(" for help.\nIt will say that one solution is to open your local Docker Preferences and add your project directory into the File Sharing tab.")]),e._v(" "),e._m(4),e._v(" "),s("p",[e._v("Information that is special to a site (such as sensitive information) is stored in the environment.")]),e._v(" "),s("p",[e._v("In this project all site-specific (sensitive) information is placed into environment files that are used by docker-compose\nto create environment variables for use inside the container code.")]),e._v(" "),e._m(5),e._v(" "),e._m(6),e._v(" "),e._m(7),e._v(" "),e._m(8),e._v(" "),s("p",[e._v("Create the .env file:")]),e._v(" "),s("p",[e._v("/server/.env")]),e._v(" "),e._m(9),e._m(10),e._v(" "),e._m(11),s("p",[e._v("In the source code this can be accessed like this")]),e._v(" "),e._m(12),e._m(13),e._v(" "),s("p",[e._v("Create the .env_site file.")]),e._v(" "),s("p",[e._v("/server/.env_site")]),e._v(" "),e._m(14),e._m(15),e._v(" "),e._m(16),s("p",[e._v("Inside the server we get and use these environment variables like this")]),e._v(" "),e._m(17),e._m(18),e._v(" "),s("p",[e._v("We also need to handle values that vary at the containerization level. For example, the name of the mongo service and\nthe ports we want the server to listen on (the view of the world as looking out from inside the container). Let's add three\nnew values: API_PORT, MONGO_PORT, and MONGO_HOST")]),e._v(" "),e._m(19),e._m(20),e._m(21),e._v(" "),e._m(22),e._v(" "),s("p",[e._v("WIP:  I want a better way to manage the prod vs dev environments and to manage the configuration parameters that need to be site\nspecific such as db passwords.  Here are some articles I'm reading about now")]),e._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://vsupalov.com/docker-arg-env-variable-guide/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://vsupalov.com/docker-arg-env-variable-guide/"),s("OutboundLink")],1),e._v(" to learn how best to pass arguments around. It's\na long but very worthwhile read.")])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://medium.com/softonic-eng/docker-compose-from-development-to-production-88000124a57c",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://medium.com/softonic-eng/docker-compose-from-development-to-production-88000124a57c"),s("OutboundLink")],1)])])]),e._v(" "),s("p",[e._v("Extract:")]),e._v(" "),e._m(23),e._v(" "),s("p",[e._v("The next two are for docker compose version 2 yet are likely to work for version 3.  This developer is including methods to set up SSL as well, with LetsEncrypt")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://modulitos.com/2016/03/lets-deploy-part-1/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://modulitos.com/2016/03/lets-deploy-part-1/"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://modulitos.com/lets-deploy-part-2/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://modulitos.com/lets-deploy-part-2/"),s("OutboundLink")],1)])]),e._v(" "),e._m(24),e._v(" "),s("p",[e._v("The recommendation is to use COPY unless you need the more powerful ADD.\nCOPY transfers files from the local machine into the container.")]),e._v(" "),e._m(25),e._v(" "),s("p",[e._v("Docker-compose is a lightweight container orchestration tool useful to coordinate one or more Docker containers. It can\ncoordinate containers defined outside the application as well. (See https://docs.docker.com/compose/compose-file/#external_links)")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker compose reference"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("Docker-compose files are written in YAML. A short one-page guide to YAML can be found "),s("a",{attrs:{href:"https://learnxinyminutes.com/docs/yaml/",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),s("OutboundLink")],1)]),e._v(" "),e._m(26),e._v(" "),e._m(27),e._m(28),e._v(" "),e._m(29),e._v(" "),s("p",[e._v("This project uses different ports for these two sides only to provide a clear example.  Hopefully, this makes it easy\nto see exactly what you might need to edit to support a more complicated network of containers.")]),e._v(" "),s("p",[e._v('ports:\n- "outside:inside"')]),e._v(" "),s("p",[e._v("Or use the long format and be explicit\nports:")]),e._v(" "),e._m(30),e._v(" "),s("p",[e._v("Expose ports without publishing them to the host machine - theyâ€™ll only be accessible to linked services.\nOnly the internal port can be specified.")]),e._v(" "),s("p",[e._v('expose: "3003"')]),e._v(" "),s("p",[e._v("The docker command line way to do this is "),s("code",[e._v("docker run -p 80:3000 my-node-app")]),e._v(" . The server running on port 3000\nwill be available through HTTP (port 80). First the container port, then the image port.\n"),s("a",{attrs:{href:"https://stackoverflow.com/questions/40801772/what-is-the-difference-between-docker-compose-ports-vs-expose",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://stackoverflow.com/questions/40801772/what-is-the-difference-between-docker-compose-ports-vs-expose"),s("OutboundLink")],1)]),e._v(" "),e._m(31),e._v(" "),s("p",[e._v("What if I want my database to be on a distant server, not to run locally on my isolated machine?\n"),s("a",{attrs:{href:"https://community.grafana.com/t/new-docker-install-with-persistent-storage-permission-problem/10896",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://community.grafana.com/t/new-docker-install-with-persistent-storage-permission-problem/10896"),s("OutboundLink")],1)]),e._v(" "),e._m(32),e._v(" "),e._m(33),e._v(" "),e._m(34),s("ul",[s("li",[s("a",{attrs:{href:"https://learnxinyminutes.com/docs/yaml/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Learn Yaml on one page"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker compose reference"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.docker.com/v17.12/docker-for-mac/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker install for Mac"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.docker.com/v17.12/install/linux/docker-ce/ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker install for Ubuntu"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker-compose install"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://gist.github.com/dwilkie/f8d6526edc5f1a8aca385df5113567e4",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker cheat sheet"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://store.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("DockerHub"),s("OutboundLink")],1),e._v(" You need access to an account on DockerHub")])])])},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker")])},function(){var e=this.$createElement,t=this._self._c||e;return t("blockquote",[t("p",[this._v("Factor IX: serve the application via containers that can easily be replaced.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"mounts-denied"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mounts-denied","aria-hidden":"true"}},[this._v("#")]),this._v(" Mounts denied")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("ERROR: for xxx  Cannot start service xxx: b'Mounts denied: ...\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"configuration-factor-iii"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configuration-factor-iii","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration (Factor III)")])},function(){var e=this.$createElement,t=this._self._c||e;return t("blockquote",[t("p",[this._v("Before running this project you must create the environment files")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The environment files are not checked into the repository. All files that begin with "),t("code",[this._v(".env")]),this._v(" are ignored in "),t("code",[this._v(".gitignore")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("In the server sub-project create two files: "),t("code",[this._v(".env")]),this._v(" and "),t("code",[this._v(".env_site")]),this._v(' We have two files to illustrate how these two\napproaches work with docker-compose.  In the docker-compose.yml file  these two files are "imported" and redeclared for\nthe use of the server application.')])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"env"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#env","aria-hidden":"true"}},[this._v("#")]),this._v(" .env")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("SAMPLE_1=A sample environment variable from .env\nMONGO_DB_NAME=nameYourDatabase\n")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("The "),s("code",[e._v(".env")]),e._v(" file is implicitly imported without you doing anything.  Ever key/value pair in the .env file needs to\nhave the key declared in the 'environment' section.\nFor example, "),s("code",[e._v("SAMPLE_1")]),e._v(" is defined in "),s("code",[e._v(".env")]),e._v(" and then declared, "),s("em",[e._v("without value")]),e._v(", in the yaml file.")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("simple-app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" MONGO_DB_NAME\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" SAMPLE_1\n")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SAMPLE_1")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SAMPLE_1")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("MONGO_DB_NAME")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("MONGO_DB_NAME")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"env-site"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#env-site","aria-hidden":"true"}},[this._v("#")]),this._v(" .env_site")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("SAMPLE_2=A sample environment variable from .env_site\nMONGO_PWORD=protectTheDatabase\nDOMAIN_NAME=jbrjga.com\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The "),t("code",[this._v(".env_site")]),this._v(" file is explicitly imported into the yaml file yet we do NOT redeclare these variables.")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("simple-app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("env_file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" ./.env_site\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" MONGO_DB_NAME\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" SAMPLE_1\n")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SAMPLE_2")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SAMPLE_2")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("MONGO_PWORD")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("MONGO_PWORD")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("DOMAIN_NAME")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("DOMAIN_NAME")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"container-environment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#container-environment","aria-hidden":"true"}},[this._v("#")]),this._v(" Container environment")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("simple-app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("env_file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" ./.env_site\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" API_PORT=3004\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" MONGO_PORT=27017\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" MONGO_HOST=mevn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("mongo\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" MONGO_DB_NAME\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" SAMPLE_1\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("mevn-app-mongo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" mevn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("mongo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" mongo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("expose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"27017"')]),e._v("\n")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("MONGO_HOST")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("MONGO_HOST")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("MONGO_PORT")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("MONGO_PORT")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// construct the full connection string")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" cStr "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'mongodb://'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("MONGO_HOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("':'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("MONGO_PORT")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" dbName\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// listen on the port defined by the external configuration")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("API_PORT")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("API_PORT")]),e._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("listen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("API_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[e._v("`Listening on port ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("${")]),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("API_PORT")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile","aria-hidden":"true"}},[this._v("#")]),this._v(" Dockerfile")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The API container is defined by the "),t("code",[this._v("Dockerfile")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("blockquote",[s("ul",[s("li",[e._v("All my stacks for production, development (or other environments) are defined via docker-compose files.")]),e._v(" "),s("li",[e._v("The compose files needed to cover all my environments are avoiding as much as possible configuration duplication.")]),e._v(" "),s("li",[e._v("I just need one simple command to work on each environment.")]),e._v(" "),s("li",[e._v("Define your productive configuration in the docker-compose.yml file.")]),e._v(" "),s("li",[e._v("Define environment variables to identify image tags or other variables that could change for any environment (staging, integration, production).")]),e._v(" "),s("li",[e._v("Use the production values as defaults, this minimizes impact in case you launch the stack in production without an expected variable.")]),e._v(" "),s("li",[e._v("In production deploy with the docker stack deploy --compose-file docker-compose.yml --with-registry-auth my-stack-name command.")]),e._v(" "),s("li",[e._v("Launch your development environment with docker-compose up -d.")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"copy-vs-add"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#copy-vs-add","aria-hidden":"true"}},[this._v("#")]),this._v(" Copy vs Add")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"docker-compose-file"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-file","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker compose file")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Many example projects use simple and/or default names for the docker services. This project doesn't so that you can see\nhow the container names play a role both inside and outside your app.  For example the mongoDB container is called\n"),t("code",[this._v("simple-app-mongo")]),this._v("  instead of the usual "),t("code",[this._v("mongo")]),this._v(".  The service name needs to be used, in the server code,\nwhen establishing a connection to the database.  (The intention for this project is to store configuration\nin the file system so the following example may not match the code but, the results will alwaus be the same.)")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("// the service as defined in the docker-compose.yml file\nconst DOCKER_MONGO_SERVICE_NAME = 'simple-app-mongo'\nconst MONGO_PORT = 27017\nconst dbName = 'simpleApp'\nconst cStr = 'mongodb://'+DOCKER_MONGO_SERVICE_NAME+':' + MONGO_PORT + '/' + dbName\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"ports-and-expose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ports-and-expose","aria-hidden":"true"}},[this._v("#")]),this._v(" Ports and Expose")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("When starting out with Docker its sometimes difficult to remember how to use the "),t("code",[this._v("ports")]),this._v(" property.  The reference says\nthe parts are "),t("code",[this._v("HOST:CONTAINER")]),this._v(" yet it is sometimes easier to think of these parts as 'from the inside' to 'the outside'.\nThe 'inside' is the port the server is listening on. The 'outside' is the port the client uses to get to this service.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("target: 80\npublished: 3003\nprotocol: tcp\nmode: host")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"persistent-storage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#persistent-storage","aria-hidden":"true"}},[this._v("#")]),this._v(" Persistent storage")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",[t("code",[this._v("volumes:\n  - .:/app\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"docker-clean-up"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-clean-up","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker clean up")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("docker system prune\n\ndocker system prune --volumes\n\ndocker container ls -a\n\n\ndocker container stop $(docker container ls -aq)\ndocker container rm $(docker container ls -aq)\n\n\ndocker image ls\n# To remove all images which are not referenced by any existing container, not just dangling ones, use the -a flag:\ndocker image prune -a\n")])])])}],!1,null,null,null);t.default=a.exports}}]);