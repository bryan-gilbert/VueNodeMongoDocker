<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Stage 2 - Debian Server with Nginx in Docker, NPM, Node, Vue | Vue, Node, Mongo, Docker</title>
    <meta name="description" content="This is a sample/template project with Dockerized Node, Express, Vue.js, MongoDB. https://github.com/bryan-gilbert/mevnd-plate">
    
    
    <link rel="preload" href="/mevnd-plate/assets/css/0.styles.819acac4.css" as="style"><link rel="preload" href="/mevnd-plate/assets/js/app.07a183a9.js" as="script"><link rel="preload" href="/mevnd-plate/assets/js/10.7e454335.js" as="script"><link rel="prefetch" href="/mevnd-plate/assets/js/11.64e0f0a3.js"><link rel="prefetch" href="/mevnd-plate/assets/js/12.51be63dc.js"><link rel="prefetch" href="/mevnd-plate/assets/js/13.6b84d8c9.js"><link rel="prefetch" href="/mevnd-plate/assets/js/14.c5b039fa.js"><link rel="prefetch" href="/mevnd-plate/assets/js/2.50eb9f96.js"><link rel="prefetch" href="/mevnd-plate/assets/js/3.8ec06dc5.js"><link rel="prefetch" href="/mevnd-plate/assets/js/4.b65d5472.js"><link rel="prefetch" href="/mevnd-plate/assets/js/5.bd363b09.js"><link rel="prefetch" href="/mevnd-plate/assets/js/6.32e3d6eb.js"><link rel="prefetch" href="/mevnd-plate/assets/js/7.a3138e99.js"><link rel="prefetch" href="/mevnd-plate/assets/js/8.bbedda2f.js"><link rel="prefetch" href="/mevnd-plate/assets/js/9.cb270790.js">
    <link rel="stylesheet" href="/mevnd-plate/assets/css/0.styles.819acac4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mevnd-plate/" class="home-link router-link-active"><!----> <span class="site-name">Vue, Node, Mongo, Docker</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mevnd-plate/" class="nav-link">Home</a></div><div class="nav-item"><a href="/mevnd-plate/docs/" class="nav-link">Docs</a></div><div class="nav-item"><a href="/mevnd-plate/may14-2019/" class="nav-link router-link-active">May14</a></div><div class="nav-item"><a href="/mevnd-plate/server/" class="nav-link">Server</a></div><div class="nav-item"><a href="/mevnd-plate/client/" class="nav-link">Client</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mevnd-plate/" class="nav-link">Home</a></div><div class="nav-item"><a href="/mevnd-plate/docs/" class="nav-link">Docs</a></div><div class="nav-item"><a href="/mevnd-plate/may14-2019/" class="nav-link router-link-active">May14</a></div><div class="nav-item"><a href="/mevnd-plate/server/" class="nav-link">Server</a></div><div class="nav-item"><a href="/mevnd-plate/client/" class="nav-link">Client</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>Project</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/mevnd-plate/" class="sidebar-link">Node Express Vue, Mongo with Docker -- MEVN-D</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mevnd-plate/#features" class="sidebar-link">Features</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/#setup" class="sidebar-link">Setup</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/#docs-2" class="sidebar-link">Docs</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/#local-domain-on-mac" class="sidebar-link">Local domain on Mac</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/#twelve-factors" class="sidebar-link">Twelve Factors</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>May 14</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Docs</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Server</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Client</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="stage-2-debian-server-with-nginx-in-docker-npm-node-vue"><a href="#stage-2-debian-server-with-nginx-in-docker-npm-node-vue" aria-hidden="true" class="header-anchor">#</a> Stage 2 - Debian Server with Nginx in Docker, NPM, Node, Vue</h1> <blockquote><p>Build on stage 1: secure server, and add Nginx (web server) in docker container with Vue client</p></blockquote> <p>The following steps take about 10 minutes to complete with a reasonable internet connection.</p> <p>Prerequisite: you have a secure server setup as described in Stage 1</p> <p>Objective: We will have a web server that is both production ready and has a great developer experience.</p> <p>We're using nginx for our web server because it is by far the best choice for our application architecture that is comprised
of static web resources complimented by API calls supported by a backend database.</p> <h2 id="install-docker-on-debian"><a href="#install-docker-on-debian" aria-hidden="true" class="header-anchor">#</a> Install Docker on Debian</h2> <p>For complete details see the <a href="https://docs.docker.com/install/linux/docker-ce/debian/" target="_blank" rel="noopener noreferrer">docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Why Debian?  We can just as easily use Ubuntu for our demonstrations because Ubuntu is a fork of Debian.  Your choice when
you extend your application.  I've chosen Debian because the work can easily port to Ubuntu if needed and Debian is known
to the more stable and secure. <a href="https://www.ubuntupit.com/debian-vs-ubuntu-top-15-things-to-know-before-choosing-the-best-one/" target="_blank" rel="noopener noreferrer">see point 11<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="set-up-the-debian-repository-for-docker"><a href="#set-up-the-debian-repository-for-docker" aria-hidden="true" class="header-anchor">#</a> Set up the debian repository for docker</h3> <div class="language- extra-class"><pre class="language-text"><code>sudo apt-get update
 
sudo apt-get install -y apt-transport-https ca-certificates curl gnupg2 software-properties-common

curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -

sudo apt-key fingerprint 0EBFCD88
# verify the finger print is 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88

# get the stable version 
sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable&quot;
</code></pre></div><h3 id="install-docker-ce"><a href="#install-docker-ce" aria-hidden="true" class="header-anchor">#</a> Install Docker-CE</h3> <div class="language- extra-class"><pre class="language-text"><code>sudo apt-get update

sudo apt-get install -y docker-ce docker-ce-cli containerd.io

# verify all is well ...
sudo docker run hello-world
</code></pre></div><h3 id="install-docker-compose"><a href="#install-docker-compose" aria-hidden="true" class="header-anchor">#</a> Install Docker-Compose</h3> <p>For complete details see the <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener noreferrer">docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
The docs show how to install docker-compose on Mac, Windows, Linus, etc.</p> <div class="language- extra-class"><pre class="language-text"><code>sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose

sudo chmod +x /usr/local/bin/docker-compose

sudo docker-compose --version
</code></pre></div><h3 id="install-npm-node"><a href="#install-npm-node" aria-hidden="true" class="header-anchor">#</a> Install NPM, Node</h3> <div class="language- extra-class"><pre class="language-text"><code>curl -sL https://deb.nodesource.com/setup_10.x | sudo bash -

sudo apt-get install -y nodejs
</code></pre></div><h3 id="setup-our-sample-project"><a href="#setup-our-sample-project" aria-hidden="true" class="header-anchor">#</a> Setup our sample project</h3> <p>It's not necessary to clone the project repository because there are just a few files needed to setup Nginx in a Docker container
and have it serve content from a Vue project.  Yet, using the project is recommended if you want to go onto the next stage.
First here are the steps to take with the repo</p> <div class="language- extra-class"><pre class="language-text"><code>git clone https://github.com/bryan-gilbert/mevnd-plate.git

cd vue

npm install # use the package.json

node  node_modules/@vue/cli/bin/vue.js create my-project

cd my-project

nom run build 

cd ../.. # back to repo root

sudo docker-compose -f d-c.yml up 
</code></pre></div><p>At this point you can view the sample application in your browser: http://&lt;ip address&gt;</p> <p>So, what's happened?</p> <ol><li>The npm install got the Vue CLI tool installed ready to go.</li> <li>Use the VLI to create a sample project: my-project</li> <li>Go into the sample Vue project and run the build. This compiles static html, css, and js files based on the Vue source.</li> <li>Return to the root directory and launch Nginx inside the docker container.</li></ol> <h2 id="development-environment"><a href="#development-environment" aria-hidden="true" class="header-anchor">#</a> Development environment</h2> <p>The only parts of this stage that a developer might want to work on is the Vue client. For this the best thing to use is the
Vue hot-swapping server.  It's amazing how it can push changes into the browser.  Run the following in the my-project folder</p> <div class="language- extra-class"><pre class="language-text"><code>npm run serve
</code></pre></div><h2 id="details"><a href="#details" aria-hidden="true" class="header-anchor">#</a> Details</h2> <p>We start by setting up the server with Docker, npm and node.js.</p> <p>Very few files contribute to this stage.  We need a very simple Docker file to set up nginx and a docker-compose file to join the nginx
with the static web site.  Plus we set up our vue directory.  Note that we don't install nginx on our server.  By placing nginx in a container
we can run the same container, with exactly the same configuration, on both our development box and any server we wish.</p> <p>This stage could have used another web technology other than Vue. React, Angular, and others are all fine for the purposes here.
I've chosen Vue because I'd like to use it and it's simple to get up and running.  One command to create a project. One to
run a development instance and one to build the production ready static web site.  That's perfect for our needs here today.</p> <p>Initial directory structure</p> <div class="language- extra-class"><pre class="language-text"><code>.
├─ stage2-docker-compose.yml
├─ vue/
└─ nginx/
   └─ DOCKERFILE
</code></pre></div><p>We then initialize the vue directory to make it a npm project.  <code>npm init</code> asks us a series of questions that, for now,
we just accept the defaults. It also creates the basic <code>package.json</code> file.  This allows us to install Vue client and keep
the setup.  Next we create the sample Vue client.</p> <div class="language- extra-class"><pre class="language-text"><code>cd vue
# to create package run
npm install  @vue/cli —save
</code></pre></div><p>Next we built this client to produce the production ready static web site.</p> <div class="language- extra-class"><pre class="language-text"><code>cd vue/my-project
# to build the client sample vue web site run
npm run build
</code></pre></div><p>We end with a directory structure like this:</p> <div class="language- extra-class"><pre class="language-text"><code>.
├─ stage2-docker-compose.yml
├─ vue/
│  ├─ package.json
│  └─ my-project/
│     ├─ dist/
│     ├─ public/
│     ├─ src/
│     └─ package.json
└─ nginx/
   └─ DOCKERFILE
</code></pre></div><p>When we build the vue client the <code>dist</code> folder is created and it contains the static web site. We link this directory to
in our docker compose file to tell nginx to server this directory for all requests to our site.</p> <p>For development of our vue client we run</p> <div class="language- extra-class"><pre class="language-text"><code>cd vue/my-project
# to build the client sample vue web site run
npm run serve
</code></pre></div><p>This launches the vue hot-swap server which watches for changes to your code, retranspiles the files and pushes the changes
to your open browser window.</p> <p>The nginx docker file is very simple, for now. It has one line that loads the nginx image from the docker hub repository.
In fact we could do without the docker file and place this image line in the docker compose file but we'll need this
nginx docker file for the next stage to set up the proxy to the API.</p> <p>nginx/DOCKERFILE</p> <div class="language- extra-class"><pre class="language-text"><code>FROM nginx
</code></pre></div><p>./stage2-docker-compose.yml</p> <div class="language- extra-class"><pre class="language-text"><code>version: &quot;3&quot;
services:
  nginx:
    container_name: nginx
    build:
      context: ./nginx
      dockerfile: Dockerfile
    ports:
      - &quot;80:80&quot;
    volumes:
      - &quot;./vue/my-project/dist/:/usr/share/nginx/html/&quot;
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/mevnd-plate/assets/js/app.07a183a9.js" defer></script><script src="/mevnd-plate/assets/js/10.7e454335.js" defer></script>
  </body>
</html>
