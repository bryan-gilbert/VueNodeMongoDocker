<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker | Vue, Node, Mongo, Docker</title>
    <meta name="description" content="This is a sample/template project with Dockerized Node, Express, Vue.js, MongoDB. https://github.com/bryan-gilbert/mevnd-plate">
    
    
    <link rel="preload" href="/mevnd-plate/assets/css/0.styles.819acac4.css" as="style"><link rel="preload" href="/mevnd-plate/assets/js/app.07a183a9.js" as="script"><link rel="preload" href="/mevnd-plate/assets/js/11.64e0f0a3.js" as="script"><link rel="prefetch" href="/mevnd-plate/assets/js/10.7e454335.js"><link rel="prefetch" href="/mevnd-plate/assets/js/12.51be63dc.js"><link rel="prefetch" href="/mevnd-plate/assets/js/13.6b84d8c9.js"><link rel="prefetch" href="/mevnd-plate/assets/js/14.c5b039fa.js"><link rel="prefetch" href="/mevnd-plate/assets/js/2.50eb9f96.js"><link rel="prefetch" href="/mevnd-plate/assets/js/3.8ec06dc5.js"><link rel="prefetch" href="/mevnd-plate/assets/js/4.b65d5472.js"><link rel="prefetch" href="/mevnd-plate/assets/js/5.bd363b09.js"><link rel="prefetch" href="/mevnd-plate/assets/js/6.32e3d6eb.js"><link rel="prefetch" href="/mevnd-plate/assets/js/7.a3138e99.js"><link rel="prefetch" href="/mevnd-plate/assets/js/8.bbedda2f.js"><link rel="prefetch" href="/mevnd-plate/assets/js/9.cb270790.js">
    <link rel="stylesheet" href="/mevnd-plate/assets/css/0.styles.819acac4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mevnd-plate/" class="home-link router-link-active"><!----> <span class="site-name">Vue, Node, Mongo, Docker</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mevnd-plate/" class="nav-link">Home</a></div><div class="nav-item"><a href="/mevnd-plate/docs/" class="nav-link">Docs</a></div><div class="nav-item"><a href="/mevnd-plate/may14-2019/" class="nav-link">May14</a></div><div class="nav-item"><a href="/mevnd-plate/server/" class="nav-link router-link-active">Server</a></div><div class="nav-item"><a href="/mevnd-plate/client/" class="nav-link">Client</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mevnd-plate/" class="nav-link">Home</a></div><div class="nav-item"><a href="/mevnd-plate/docs/" class="nav-link">Docs</a></div><div class="nav-item"><a href="/mevnd-plate/may14-2019/" class="nav-link">May14</a></div><div class="nav-item"><a href="/mevnd-plate/server/" class="nav-link router-link-active">Server</a></div><div class="nav-item"><a href="/mevnd-plate/client/" class="nav-link">Client</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Project</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>May 14</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Docs</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Server</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/mevnd-plate/server/" class="sidebar-link">API Server: Node, Express, Mongo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mevnd-plate/server/#run" class="sidebar-link">Run</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/#package-json" class="sidebar-link">package.json</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/#placeholder-for-i18n" class="sidebar-link">Placeholder for I18N</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/#unhandled-rejections-and-exceptions" class="sidebar-link">Unhandled rejections and exceptions</a></li></ul></li><li><a href="/mevnd-plate/server/docker.html" class="active sidebar-link">Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#mounts-denied" class="sidebar-link">Mounts denied</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#configuration-factor-iii" class="sidebar-link">Configuration (Factor III)</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#dockerfile" class="sidebar-link">Dockerfile</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#copy-vs-add" class="sidebar-link">Copy vs Add</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#docker-compose-file" class="sidebar-link">Docker compose file</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#ports-and-expose" class="sidebar-link">Ports and Expose</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#persistent-storage" class="sidebar-link">Persistent storage</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#docker-clean-up" class="sidebar-link">Docker clean up</a></li></ul></li><li><a href="/mevnd-plate/server/express.html" class="sidebar-link">Express and Node.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mevnd-plate/server/express.html#express" class="sidebar-link">Express</a></li></ul></li><li><a href="/mevnd-plate/server/mongodb.html" class="sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mevnd-plate/server/mongodb.html#authentication" class="sidebar-link">Authentication</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/mongodb.html#mongoose" class="sidebar-link">Mongoose</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Client</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="docker"><a href="#docker" aria-hidden="true" class="header-anchor">#</a> Docker</h1> <blockquote><p>Factor IX: serve the application via containers that can easily be replaced.</p></blockquote> <p>Docker runs the individual components of our application in containers. For example, the API server, the MongoDB, etc.</p> <p>Docker-compose orchestrates the set of containers that provide the whole application.</p> <p>You need to have docker and docker-compose installed to run this project.  To get started you can see the helpful references at the bottom of this page</p> <h2 id="mounts-denied"><a href="#mounts-denied" aria-hidden="true" class="header-anchor">#</a> Mounts denied</h2> <p>On the Mac when you first start the app you may see an error like this:</p> <div class="language- extra-class"><pre class="language-text"><code>ERROR: for xxx  Cannot start service xxx: b'Mounts denied: ...
</code></pre></div><p>The error message will tell you to look <a href="https://docs.docker.com/docker-for-mac/osxfs/#namespaces" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for help.
It will say that one solution is to open your local Docker Preferences and add your project directory into the File Sharing tab.</p> <h2 id="configuration-factor-iii"><a href="#configuration-factor-iii" aria-hidden="true" class="header-anchor">#</a> Configuration (Factor III)</h2> <p>Information that is special to a site (such as sensitive information) is stored in the environment.</p> <p>In this project all site-specific (sensitive) information is placed into environment files that are used by docker-compose
to create environment variables for use inside the container code.</p> <blockquote><p>Before running this project you must create the environment files</p></blockquote> <p>The environment files are not checked into the repository. All files that begin with <code>.env</code> are ignored in <code>.gitignore</code>.</p> <p>In the server sub-project create two files: <code>.env</code> and <code>.env_site</code> We have two files to illustrate how these two
approaches work with docker-compose.  In the docker-compose.yml file  these two files are &quot;imported&quot; and redeclared for
the use of the server application.</p> <h3 id="env"><a href="#env" aria-hidden="true" class="header-anchor">#</a> .env</h3> <p>Create the .env file:</p> <p>/server/.env</p> <div class="language- extra-class"><pre class="language-text"><code>SAMPLE_1=A sample environment variable from .env
MONGO_DB_NAME=nameYourDatabase
</code></pre></div><p>The <code>.env</code> file is implicitly imported without you doing anything.  Ever key/value pair in the .env file needs to
have the key declared in the 'environment' section.
For example, <code>SAMPLE_1</code> is defined in <code>.env</code> and then declared, <em>without value</em>, in the yaml file.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">simple-app</span><span class="token punctuation">:</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> MONGO_DB_NAME
      <span class="token punctuation">-</span> SAMPLE_1
</code></pre></div><p>In the source code this can be accessed like this</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">SAMPLE_1</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SAMPLE_1</span>
<span class="token keyword">const</span> <span class="token constant">MONGO_DB_NAME</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGO_DB_NAME</span>
</code></pre></div><h3 id="env-site"><a href="#env-site" aria-hidden="true" class="header-anchor">#</a> .env_site</h3> <p>Create the .env_site file.</p> <p>/server/.env_site</p> <div class="language- extra-class"><pre class="language-text"><code>SAMPLE_2=A sample environment variable from .env_site
MONGO_PWORD=protectTheDatabase
DOMAIN_NAME=jbrjga.com
</code></pre></div><p>The <code>.env_site</code> file is explicitly imported into the yaml file yet we do NOT redeclare these variables.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">simple-app</span><span class="token punctuation">:</span>
    <span class="token key atrule">env_file</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./.env_site
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> MONGO_DB_NAME
      <span class="token punctuation">-</span> SAMPLE_1
</code></pre></div><p>Inside the server we get and use these environment variables like this</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">SAMPLE_2</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SAMPLE_2</span>
<span class="token keyword">const</span> <span class="token constant">MONGO_PWORD</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGO_PWORD</span>
<span class="token keyword">const</span> <span class="token constant">DOMAIN_NAME</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DOMAIN_NAME</span>
</code></pre></div><h3 id="container-environment"><a href="#container-environment" aria-hidden="true" class="header-anchor">#</a> Container environment</h3> <p>We also need to handle values that vary at the containerization level. For example, the name of the mongo service and
the ports we want the server to listen on (the view of the world as looking out from inside the container). Let's add three
new values: API_PORT, MONGO_PORT, and MONGO_HOST</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">simple-app</span><span class="token punctuation">:</span>
    <span class="token key atrule">env_file</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./.env_site
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> API_PORT=3004
      <span class="token punctuation">-</span> MONGO_PORT=27017
      <span class="token punctuation">-</span> MONGO_HOST=mevn<span class="token punctuation">-</span>app<span class="token punctuation">-</span>mongo
      <span class="token punctuation">-</span> MONGO_DB_NAME
      <span class="token punctuation">-</span> SAMPLE_1
  <span class="token key atrule">mevn-app-mongo</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mevn<span class="token punctuation">-</span>app<span class="token punctuation">-</span>mongo
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo
    <span class="token key atrule">expose</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;27017&quot;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">MONGO_HOST</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGO_HOST</span>
<span class="token keyword">const</span> <span class="token constant">MONGO_PORT</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGO_PORT</span>
<span class="token comment">// construct the full connection string</span>
<span class="token keyword">const</span> cStr <span class="token operator">=</span> <span class="token string">'mongodb://'</span><span class="token operator">+</span><span class="token constant">MONGO_HOST</span><span class="token operator">+</span><span class="token string">':'</span> <span class="token operator">+</span> <span class="token constant">MONGO_PORT</span> <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> dbName

<span class="token operator">...</span>
<span class="token comment">// listen on the port defined by the external configuration</span>
<span class="token keyword">const</span> <span class="token constant">API_PORT</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">API_PORT</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">API_PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">API_PORT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="dockerfile"><a href="#dockerfile" aria-hidden="true" class="header-anchor">#</a> Dockerfile</h2> <p>The API container is defined by the <code>Dockerfile</code></p> <p>WIP:  I want a better way to manage the prod vs dev environments and to manage the configuration parameters that need to be site
specific such as db passwords.  Here are some articles I'm reading about now</p> <ul><li><p><a href="https://vsupalov.com/docker-arg-env-variable-guide/" target="_blank" rel="noopener noreferrer">https://vsupalov.com/docker-arg-env-variable-guide/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to learn how best to pass arguments around. It's
a long but very worthwhile read.</p></li> <li><p><a href="https://medium.com/softonic-eng/docker-compose-from-development-to-production-88000124a57c" target="_blank" rel="noopener noreferrer">https://medium.com/softonic-eng/docker-compose-from-development-to-production-88000124a57c<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <p>Extract:</p> <blockquote><ul><li>All my stacks for production, development (or other environments) are defined via docker-compose files.</li> <li>The compose files needed to cover all my environments are avoiding as much as possible configuration duplication.</li> <li>I just need one simple command to work on each environment.</li> <li>Define your productive configuration in the docker-compose.yml file.</li> <li>Define environment variables to identify image tags or other variables that could change for any environment (staging, integration, production).</li> <li>Use the production values as defaults, this minimizes impact in case you launch the stack in production without an expected variable.</li> <li>In production deploy with the docker stack deploy --compose-file docker-compose.yml --with-registry-auth my-stack-name command.</li> <li>Launch your development environment with docker-compose up -d.</li></ul></blockquote> <p>The next two are for docker compose version 2 yet are likely to work for version 3.  This developer is including methods to set up SSL as well, with LetsEncrypt</p> <ul><li><a href="https://modulitos.com/2016/03/lets-deploy-part-1/" target="_blank" rel="noopener noreferrer">https://modulitos.com/2016/03/lets-deploy-part-1/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://modulitos.com/lets-deploy-part-2/" target="_blank" rel="noopener noreferrer">https://modulitos.com/lets-deploy-part-2/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="copy-vs-add"><a href="#copy-vs-add" aria-hidden="true" class="header-anchor">#</a> Copy vs Add</h2> <p>The recommendation is to use COPY unless you need the more powerful ADD.
COPY transfers files from the local machine into the container.</p> <h2 id="docker-compose-file"><a href="#docker-compose-file" aria-hidden="true" class="header-anchor">#</a> Docker compose file</h2> <p>Docker-compose is a lightweight container orchestration tool useful to coordinate one or more Docker containers. It can
coordinate containers defined outside the application as well. (See https://docs.docker.com/compose/compose-file/#external_links)</p> <p><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener noreferrer">docker compose reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Docker-compose files are written in YAML. A short one-page guide to YAML can be found <a href="https://learnxinyminutes.com/docs/yaml/" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Many example projects use simple and/or default names for the docker services. This project doesn't so that you can see
how the container names play a role both inside and outside your app.  For example the mongoDB container is called
<code>simple-app-mongo</code>  instead of the usual <code>mongo</code>.  The service name needs to be used, in the server code,
when establishing a connection to the database.  (The intention for this project is to store configuration
in the file system so the following example may not match the code but, the results will alwaus be the same.)</p> <div class="language- extra-class"><pre class="language-text"><code>// the service as defined in the docker-compose.yml file
const DOCKER_MONGO_SERVICE_NAME = 'simple-app-mongo'
const MONGO_PORT = 27017
const dbName = 'simpleApp'
const cStr = 'mongodb://'+DOCKER_MONGO_SERVICE_NAME+':' + MONGO_PORT + '/' + dbName
</code></pre></div><h2 id="ports-and-expose"><a href="#ports-and-expose" aria-hidden="true" class="header-anchor">#</a> Ports and Expose</h2> <p>When starting out with Docker its sometimes difficult to remember how to use the <code>ports</code> property.  The reference says
the parts are <code>HOST:CONTAINER</code> yet it is sometimes easier to think of these parts as 'from the inside' to 'the outside'.
The 'inside' is the port the server is listening on. The 'outside' is the port the client uses to get to this service.</p> <p>This project uses different ports for these two sides only to provide a clear example.  Hopefully, this makes it easy
to see exactly what you might need to edit to support a more complicated network of containers.</p> <p>ports:
- &quot;outside:inside&quot;</p> <p>Or use the long format and be explicit
ports:</p> <ul><li>target: 80
published: 3003
protocol: tcp
mode: host</li></ul> <p>Expose ports without publishing them to the host machine - they’ll only be accessible to linked services.
Only the internal port can be specified.</p> <p>expose: &quot;3003&quot;</p> <p>The docker command line way to do this is <code>docker run -p 80:3000 my-node-app</code> . The server running on port 3000
will be available through HTTP (port 80). First the container port, then the image port.
<a href="https://stackoverflow.com/questions/40801772/what-is-the-difference-between-docker-compose-ports-vs-expose" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/40801772/what-is-the-difference-between-docker-compose-ports-vs-expose<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="persistent-storage"><a href="#persistent-storage" aria-hidden="true" class="header-anchor">#</a> Persistent storage</h2> <p>What if I want my database to be on a distant server, not to run locally on my isolated machine?
<a href="https://community.grafana.com/t/new-docker-install-with-persistent-storage-permission-problem/10896" target="_blank" rel="noopener noreferrer">https://community.grafana.com/t/new-docker-install-with-persistent-storage-permission-problem/10896<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <pre><code>volumes:
  - .:/app
</code></pre> <h2 id="docker-clean-up"><a href="#docker-clean-up" aria-hidden="true" class="header-anchor">#</a> Docker clean up</h2> <div class="language- extra-class"><pre class="language-text"><code>docker system prune

docker system prune --volumes

docker container ls -a


docker container stop $(docker container ls -aq)
docker container rm $(docker container ls -aq)


docker image ls
# To remove all images which are not referenced by any existing container, not just dangling ones, use the -a flag:
docker image prune -a
</code></pre></div><ul><li><a href="https://learnxinyminutes.com/docs/yaml/" target="_blank" rel="noopener noreferrer">Learn Yaml on one page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener noreferrer">docker compose reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.docker.com/v17.12/docker-for-mac/install/" target="_blank" rel="noopener noreferrer">Docker install for Mac<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.docker.com/v17.12/install/linux/docker-ce/ubuntu/" target="_blank" rel="noopener noreferrer">Docker install for Ubuntu<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener noreferrer">Docker-compose install<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://gist.github.com/dwilkie/f8d6526edc5f1a8aca385df5113567e4" target="_blank" rel="noopener noreferrer">Docker cheat sheet<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://store.docker.com/" target="_blank" rel="noopener noreferrer">DockerHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> You need access to an account on DockerHub</li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/mevnd-plate/server/" class="prev router-link-active">
          API Server: Node, Express, Mongo
        </a></span> <span class="next"><a href="/mevnd-plate/server/express.html">
          Express and Node.js
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/mevnd-plate/assets/js/app.07a183a9.js" defer></script><script src="/mevnd-plate/assets/js/11.64e0f0a3.js" defer></script>
  </body>
</html>
