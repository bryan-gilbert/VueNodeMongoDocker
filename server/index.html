<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API Server: Node, Express, Mongo | Vue, Node, Mongo, Docker</title>
    <meta name="description" content="This is a sample/template project with Dockerized Node, Express, Vue.js, MongoDB. https://github.com/bryan-gilbert/mevnd-plate">
    
    
    <link rel="preload" href="/mevnd-plate/assets/css/0.styles.819acac4.css" as="style"><link rel="preload" href="/mevnd-plate/assets/js/app.07a183a9.js" as="script"><link rel="preload" href="/mevnd-plate/assets/js/4.b65d5472.js" as="script"><link rel="prefetch" href="/mevnd-plate/assets/js/10.7e454335.js"><link rel="prefetch" href="/mevnd-plate/assets/js/11.64e0f0a3.js"><link rel="prefetch" href="/mevnd-plate/assets/js/12.51be63dc.js"><link rel="prefetch" href="/mevnd-plate/assets/js/13.6b84d8c9.js"><link rel="prefetch" href="/mevnd-plate/assets/js/14.c5b039fa.js"><link rel="prefetch" href="/mevnd-plate/assets/js/2.50eb9f96.js"><link rel="prefetch" href="/mevnd-plate/assets/js/3.8ec06dc5.js"><link rel="prefetch" href="/mevnd-plate/assets/js/5.bd363b09.js"><link rel="prefetch" href="/mevnd-plate/assets/js/6.32e3d6eb.js"><link rel="prefetch" href="/mevnd-plate/assets/js/7.a3138e99.js"><link rel="prefetch" href="/mevnd-plate/assets/js/8.bbedda2f.js"><link rel="prefetch" href="/mevnd-plate/assets/js/9.cb270790.js">
    <link rel="stylesheet" href="/mevnd-plate/assets/css/0.styles.819acac4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mevnd-plate/" class="home-link router-link-active"><!----> <span class="site-name">Vue, Node, Mongo, Docker</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mevnd-plate/" class="nav-link">Home</a></div><div class="nav-item"><a href="/mevnd-plate/docs/" class="nav-link">Docs</a></div><div class="nav-item"><a href="/mevnd-plate/may14-2019/" class="nav-link">May14</a></div><div class="nav-item"><a href="/mevnd-plate/server/" class="nav-link router-link-exact-active router-link-active">Server</a></div><div class="nav-item"><a href="/mevnd-plate/client/" class="nav-link">Client</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mevnd-plate/" class="nav-link">Home</a></div><div class="nav-item"><a href="/mevnd-plate/docs/" class="nav-link">Docs</a></div><div class="nav-item"><a href="/mevnd-plate/may14-2019/" class="nav-link">May14</a></div><div class="nav-item"><a href="/mevnd-plate/server/" class="nav-link router-link-exact-active router-link-active">Server</a></div><div class="nav-item"><a href="/mevnd-plate/client/" class="nav-link">Client</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Project</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>May 14</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Docs</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Server</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/mevnd-plate/server/" class="active sidebar-link">API Server: Node, Express, Mongo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mevnd-plate/server/#run" class="sidebar-link">Run</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/#package-json" class="sidebar-link">package.json</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/#placeholder-for-i18n" class="sidebar-link">Placeholder for I18N</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/#unhandled-rejections-and-exceptions" class="sidebar-link">Unhandled rejections and exceptions</a></li></ul></li><li><a href="/mevnd-plate/server/docker.html" class="sidebar-link">Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#mounts-denied" class="sidebar-link">Mounts denied</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#configuration-factor-iii" class="sidebar-link">Configuration (Factor III)</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#dockerfile" class="sidebar-link">Dockerfile</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#copy-vs-add" class="sidebar-link">Copy vs Add</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#docker-compose-file" class="sidebar-link">Docker compose file</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#ports-and-expose" class="sidebar-link">Ports and Expose</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#persistent-storage" class="sidebar-link">Persistent storage</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/docker.html#docker-clean-up" class="sidebar-link">Docker clean up</a></li></ul></li><li><a href="/mevnd-plate/server/express.html" class="sidebar-link">Express and Node.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mevnd-plate/server/express.html#express" class="sidebar-link">Express</a></li></ul></li><li><a href="/mevnd-plate/server/mongodb.html" class="sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mevnd-plate/server/mongodb.html#authentication" class="sidebar-link">Authentication</a></li><li class="sidebar-sub-header"><a href="/mevnd-plate/server/mongodb.html#mongoose" class="sidebar-link">Mongoose</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Client</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="api-server-node-express-mongo"><a href="#api-server-node-express-mongo" aria-hidden="true" class="header-anchor">#</a> API Server: Node, Express, Mongo</h1> <blockquote><p>The server sub-project provides the API server</p></blockquote> <p>The sub-project is located in <code>server/</code>
The code is located in <code>server/src/</code> directory.
The code should be self-documenting.
Our <a href="/mevnd-plate/server/docker.html">docker</a> docs say more about how the containerization is managed.</p> <p>This sub-project borrows from
<a href="https://dev.to/jay97/docker-compose-an-express-and-mongo-app-aai" target="_blank" rel="noopener noreferrer">https://dev.to/jay97/docker-compose-an-express-and-mongo-app-aai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
and
<a href="https://nodejs.org/de/docs/guides/nodejs-docker-webapp/" target="_blank" rel="noopener noreferrer">https://nodejs.org/de/docs/guides/nodejs-docker-webapp/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="run"><a href="#run" aria-hidden="true" class="header-anchor">#</a> Run</h2> <p>To run the server ....</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose up --build
</code></pre></div><p>Or run the services in the background and optionally follow the logs of a container</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose up --build -d 

docker-compose logs -f simple-app
</code></pre></div><p>To see what's inside a container run the exec command with sh</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose exec simple-app sh
</code></pre></div><p>To test the server <code>curl http://localhost:3005</code> (may need to adjust the port as configuration changes)</p> <h2 id="package-json"><a href="#package-json" aria-hidden="true" class="header-anchor">#</a> package.json</h2> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAkNJREFUOBGdlc9vDVEUx7/3PlUawaaKiA2LZ6PSZQled8TGQkjQCGn/AF3YWMzCxqLdIxG0ElY2xK5F0i4FGyTsBKMbQuj7NeNzZjLhjZn0eTe5b+4953y/95x7zj3PqWwE2oxqryoaU6wzzDXyuqWGFpC9VKCvRVD3jzDQBqDnAU9AskeR6nL6ktjF2oJ8Lfs3yG+opZsQ//ibo5PwsnZpPYZeh9TGk1h3+S5qRctax66lQfXrAPrTzBqSJ/qpSV3R+4z0D2Gg3erTAxRD+DSlz7qn62pmhh3fSSy36hTk08hDrI7j6TuzSQktzIoeMqvc0VGUzzsIyjaBRiB9hOdvieSYhe8TW6cL3NtBTprqmsyAdrBhDOu5d4bTJW3SRi1xwid90JHSMM26aFj4O/UY1TZ916jlbB+XW2XO/jeZHZDe8yyrKgkd9vBbndVxecn0PY04wdbJQc1DNk7gISEv90RmoBQbUpvjlpSoZ6I80KniCfUO8iHcHczru94bNoZDuu1xd4FFP2GPdk2QN4zAOjiamvf6xUMXb1M6yyPqy9uuujeMA2vvu6EXXlf1jVu8Rshj2qETqxLkDQxjldKGA670pUR0jZaeoZim+kfymNK92RrGsMbBKG4OTV3UR90vLXQLc7tO8jsDQ0ioueaQuWDtawAap8NJsiLNsV5M6myFlSObA9pPZaTtK9JTcjBR3L4y0s4GWyWUBkRhEk3aYK0iXiPvosFmpPa1v4C2hnnrNcDnIGkx55DNo32FvvAv4DeiOaw0dqR9uwAAAABJRU5ErkJggg==" alt="unchecked" title="unchecked"> WIP: To do for this project is to have a single docker configuration and yet choose between the production
and development script.  Currently, the set up loads 'start.dev' with hot swap via <code>nodemon</code></p> <p>Nodemon monitors the code for changes and restarts the server when it sees changes. When Nodemon is used inside a docker
container it requires the use of the legacy watch flag -L</p> <div class="language- extra-class"><pre class="language-text"><code>    ...
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;node index.js&quot;,
    &quot;start.dev&quot;: &quot;nodemon -L&quot;
  },
  ...
</code></pre></div><ul><li><a href="https://github.com/docker/labs/issues/378" target="_blank" rel="noopener noreferrer">https://github.com/docker/labs/issues/378<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://gist.github.com/ksmithut/e126f7ddb40b760487a17e8b569a77b5" target="_blank" rel="noopener noreferrer">https://gist.github.com/ksmithut/e126f7ddb40b760487a17e8b569a77b5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="placeholder-for-i18n"><a href="#placeholder-for-i18n" aria-hidden="true" class="header-anchor">#</a> Placeholder for I18N</h2> <p>We add a method to the express application that can be used, in the future, to translate strings.
It's far easier to start using this wrapper in the early stages of development
rather than adding it later.  You can decide later what package you wish to use to manage translations.</p> <div class="language- extra-class"><pre class="language-text"><code>app = express()
...
// Usage:  req.t('some string') returns the same string but in the future you can translate the text
app.t = txt =&gt; {
  return txt
}
</code></pre></div><h2 id="unhandled-rejections-and-exceptions"><a href="#unhandled-rejections-and-exceptions" aria-hidden="true" class="header-anchor">#</a> Unhandled rejections and exceptions</h2> <p>In some high level module define a set of handlers for any exceptions or promise rejections that are not handled by
the code.  Optionally exit the process.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">initUnhandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/*
  Define application wide handlers for unhandled exceptions and rejections.
  See https://nodejs.org/api/process.html#process_event_unhandledrejection
   */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">listeners</span><span class="token punctuation">(</span><span class="token string">'unhandledRejection'</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'unhandledRejection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error <span class="token comment">/* , promise */</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'-=-=-=-=-= UNHANDLED REJECTION %s %O'</span><span class="token punctuation">,</span> error<span class="token punctuation">,</span> error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">listeners</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'.-.-.-.-.-. UNCAUGHT EXCEPTION %s %O'</span><span class="token punctuation">,</span> error<span class="token punctuation">,</span> error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/mevnd-plate/docs/" class="prev">
          Docs: VuePress
        </a></span> <span class="next"><a href="/mevnd-plate/server/docker.html">
          Docker
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/mevnd-plate/assets/js/app.07a183a9.js" defer></script><script src="/mevnd-plate/assets/js/4.b65d5472.js" defer></script>
  </body>
</html>
